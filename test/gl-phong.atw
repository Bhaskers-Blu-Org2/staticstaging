# Dingus preamble.
extern dingus.projection: Mat4;
extern dingus.model: Mat4;
extern dingus.view: Mat4;
extern bunny.positions: Vec3 Array;
extern bunny.normals: Vec3 Array;

# Our variables.
var projection = dingus.projection;
var model = dingus.model;
var view = dingus.view;
var position = bunny.positions;
var normal = bunny.normals;

var shininess = 0.5;

render r<
  vtx s<
    var light_position = vec3(1.0, 1.0, 1.0); # TODO

    var view_model = view * model;
    var view_model_position = view_model * vec4(position, 1.0);

    var camera_position = vec3(view_model_position);

    gl_Position = projection * view_model_position;

    # Convert to world space.
    var position_world = vec3(model * vec4(position, 1.0));
    var normal_world = normalize(vec3(model * vec4(position, 0.0)));
    var view_direction = normalize(camera_position - position_world);

    var light_direction = normalize(light_position - position_world);

    var norm_norm = normalize(normal);

    frag s<
      # Phong power.
      var r = -(reflect(light_direction, norm_norm));
      var power = pow(max(0.0, dot(view_direction, r)), shininess);

      gl_FragColor = vec4(power, power, power, 1.0);
    >
  >
>
